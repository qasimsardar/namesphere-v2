c710ff622ec9ba634698749e38834ce8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.updateIdentitySchema = exports.insertIdentitySchema = exports.loginSchema = exports.registerSchema = exports.auditLogsRelations = exports.identitiesRelations = exports.userCredentialsRelations = exports.usersRelations = exports.auditLogs = exports.identities = exports.userCredentials = exports.users = exports.sessions = void 0;
const drizzle_orm_1 = require("drizzle-orm");
const pg_core_1 = require("drizzle-orm/pg-core");
const drizzle_zod_1 = require("drizzle-zod");
const zod_1 = require("zod");
// Session storage table (required for Replit Auth)
exports.sessions = (0, pg_core_1.pgTable)("sessions", {
    sid: (0, pg_core_1.varchar)("sid").primaryKey(),
    sess: (0, pg_core_1.jsonb)("sess").notNull(),
    expire: (0, pg_core_1.timestamp)("expire").notNull(),
}, (table) => [(0, pg_core_1.index)("IDX_session_expire").on(table.expire)]);
// User storage table (supports both Replit Auth and username/password)
exports.users = (0, pg_core_1.pgTable)("users", {
    id: (0, pg_core_1.varchar)("id").primaryKey().default((0, drizzle_orm_1.sql) `gen_random_uuid()`),
    email: (0, pg_core_1.varchar)("email").unique(),
    firstName: (0, pg_core_1.varchar)("first_name"),
    lastName: (0, pg_core_1.varchar)("last_name"),
    profileImageUrl: (0, pg_core_1.varchar)("profile_image_url"),
    authProvider: (0, pg_core_1.varchar)("auth_provider").notNull().default("replit"), // "replit" or "local"
    createdAt: (0, pg_core_1.timestamp)("created_at").defaultNow(),
    updatedAt: (0, pg_core_1.timestamp)("updated_at").defaultNow(),
});
// User credentials table for username/password authentication
exports.userCredentials = (0, pg_core_1.pgTable)("user_credentials", {
    id: (0, pg_core_1.varchar)("id").primaryKey().default((0, drizzle_orm_1.sql) `gen_random_uuid()`),
    userId: (0, pg_core_1.varchar)("user_id").notNull().unique().references(() => exports.users.id, { onDelete: "cascade" }),
    username: (0, pg_core_1.varchar)("username").notNull().unique(),
    passwordHash: (0, pg_core_1.text)("password_hash").notNull(),
    createdAt: (0, pg_core_1.timestamp)("created_at").defaultNow(),
    updatedAt: (0, pg_core_1.timestamp)("updated_at").defaultNow(),
}, (table) => [
    (0, pg_core_1.index)("user_credentials_user_id_idx").on(table.userId),
    (0, pg_core_1.index)("user_credentials_username_idx").on(table.username),
]);
// Identity profiles table
exports.identities = (0, pg_core_1.pgTable)("identities", {
    id: (0, pg_core_1.varchar)("id").primaryKey().default((0, drizzle_orm_1.sql) `gen_random_uuid()`),
    userId: (0, pg_core_1.varchar)("user_id").notNull().references(() => exports.users.id, { onDelete: "cascade" }),
    personalName: (0, pg_core_1.text)("personal_name").notNull(),
    context: (0, pg_core_1.text)("context").notNull(),
    otherNames: (0, pg_core_1.text)("other_names").array().default([]),
    // Optional attributes for enhanced identity profiles
    pronouns: (0, pg_core_1.text)("pronouns"),
    title: (0, pg_core_1.text)("title"),
    avatarUrl: (0, pg_core_1.text)("avatar_url"),
    socialLinks: (0, pg_core_1.jsonb)("social_links").default({}), // {platform: url} mapping
    isPrimary: (0, pg_core_1.boolean)("is_primary").default(false),
    isDiscoverable: (0, pg_core_1.boolean)("is_discoverable").default(false), // Controls visibility in public search
    createdAt: (0, pg_core_1.timestamp)("created_at").defaultNow(),
    updatedAt: (0, pg_core_1.timestamp)("updated_at").defaultNow(),
}, (table) => [
    (0, pg_core_1.index)("identities_user_id_idx").on(table.userId),
    (0, pg_core_1.index)("identities_context_idx").on(table.context),
]);
// Audit log table
exports.auditLogs = (0, pg_core_1.pgTable)("audit_logs", {
    id: (0, pg_core_1.varchar)("id").primaryKey().default((0, drizzle_orm_1.sql) `gen_random_uuid()`),
    userId: (0, pg_core_1.varchar)("user_id").notNull().references(() => exports.users.id, { onDelete: "cascade" }),
    entity: (0, pg_core_1.text)("entity").notNull(),
    entityId: (0, pg_core_1.varchar)("entity_id").notNull(),
    operation: (0, pg_core_1.text)("operation").notNull(), // create|update|delete|set-primary
    diff: (0, pg_core_1.jsonb)("diff"),
    createdAt: (0, pg_core_1.timestamp)("created_at").defaultNow(),
}, (table) => [
    (0, pg_core_1.index)("audit_logs_user_id_idx").on(table.userId),
    (0, pg_core_1.index)("audit_logs_entity_idx").on(table.entity),
]);
// Relations
exports.usersRelations = (0, drizzle_orm_1.relations)(exports.users, ({ many, one }) => ({
    identities: many(exports.identities),
    auditLogs: many(exports.auditLogs),
    credentials: one(exports.userCredentials),
}));
exports.userCredentialsRelations = (0, drizzle_orm_1.relations)(exports.userCredentials, ({ one }) => ({
    user: one(exports.users, {
        fields: [exports.userCredentials.userId],
        references: [exports.users.id],
    }),
}));
exports.identitiesRelations = (0, drizzle_orm_1.relations)(exports.identities, ({ one }) => ({
    user: one(exports.users, {
        fields: [exports.identities.userId],
        references: [exports.users.id],
    }),
}));
exports.auditLogsRelations = (0, drizzle_orm_1.relations)(exports.auditLogs, ({ one }) => ({
    user: one(exports.users, {
        fields: [exports.auditLogs.userId],
        references: [exports.users.id],
    }),
}));
// Registration schema for username/password
exports.registerSchema = zod_1.z.object({
    username: zod_1.z.string().min(3).max(50).regex(/^[a-zA-Z0-9_-]+$/, "Username can only contain letters, numbers, underscores, and hyphens"),
    password: zod_1.z.string().min(8).max(100),
    confirmPassword: zod_1.z.string(),
    email: zod_1.z.string().email(),
    firstName: zod_1.z.string().min(1).max(100),
    lastName: zod_1.z.string().min(1).max(100),
}).refine((data) => data.password === data.confirmPassword, {
    message: "Passwords don't match",
    path: ["confirmPassword"],
});
// Login schema for username/password
exports.loginSchema = zod_1.z.object({
    username: zod_1.z.string().min(1, "Username is required"),
    password: zod_1.z.string().min(1, "Password is required"),
});
exports.insertIdentitySchema = (0, drizzle_zod_1.createInsertSchema)(exports.identities, {
    context: zod_1.z.enum(["work", "gaming", "social", "legal"]),
    socialLinks: zod_1.z.record(zod_1.z.string(), zod_1.z.string().url()).optional().default({}),
}).omit({
    id: true,
    userId: true,
    createdAt: true,
    updatedAt: true,
});
exports.updateIdentitySchema = exports.insertIdentitySchema.partial();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsc0JBQXNCLENBQUM7SUFDbkQsUUFBUSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLHNCQUFzQixDQUFDO0NBQ3BELENBQUMsQ0FBQztBQUtVLFFBQUEsb0JBQW9CLEdBQUcsSUFBQSxnQ0FBa0IsRUFBQyxrQkFBVSxFQUFFO0lBQ2pFLE9BQU8sRUFBRSxPQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDdEQsV0FBVyxFQUFFLE9BQUMsQ0FBQyxNQUFNLENBQUMsT0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7Q0FDM0UsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNOLEVBQUUsRUFBRSxJQUFJO0lBQ1IsTUFBTSxFQUFFLElBQUk7SUFDWixTQUFTLEVBQUUsSUFBSTtJQUNmLFNBQVMsRUFBRSxJQUFJO0NBQ2hCLENBQUMsQ0FBQztBQUVVLFFBQUEsb0JBQW9CLEdBQUcsNEJBQW9CLENBQUMsT0FBTyxFQUFFLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zaGFyZWQvc2NoZW1hLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNxbCwgcmVsYXRpb25zIH0gZnJvbSAnZHJpenpsZS1vcm0nO1xuaW1wb3J0IHtcbiAgYm9vbGVhbixcbiAgaW5kZXgsXG4gIGpzb25iLFxuICBwZ1RhYmxlLFxuICB0ZXh0LFxuICB0aW1lc3RhbXAsXG4gIHZhcmNoYXIsXG59IGZyb20gXCJkcml6emxlLW9ybS9wZy1jb3JlXCI7XG5pbXBvcnQgeyBjcmVhdGVJbnNlcnRTY2hlbWEgfSBmcm9tIFwiZHJpenpsZS16b2RcIjtcbmltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5cbi8vIFNlc3Npb24gc3RvcmFnZSB0YWJsZSAocmVxdWlyZWQgZm9yIFJlcGxpdCBBdXRoKVxuZXhwb3J0IGNvbnN0IHNlc3Npb25zID0gcGdUYWJsZShcbiAgXCJzZXNzaW9uc1wiLFxuICB7XG4gICAgc2lkOiB2YXJjaGFyKFwic2lkXCIpLnByaW1hcnlLZXkoKSxcbiAgICBzZXNzOiBqc29uYihcInNlc3NcIikubm90TnVsbCgpLFxuICAgIGV4cGlyZTogdGltZXN0YW1wKFwiZXhwaXJlXCIpLm5vdE51bGwoKSxcbiAgfSxcbiAgKHRhYmxlKSA9PiBbaW5kZXgoXCJJRFhfc2Vzc2lvbl9leHBpcmVcIikub24odGFibGUuZXhwaXJlKV0sXG4pO1xuXG4vLyBVc2VyIHN0b3JhZ2UgdGFibGUgKHN1cHBvcnRzIGJvdGggUmVwbGl0IEF1dGggYW5kIHVzZXJuYW1lL3Bhc3N3b3JkKVxuZXhwb3J0IGNvbnN0IHVzZXJzID0gcGdUYWJsZShcInVzZXJzXCIsIHtcbiAgaWQ6IHZhcmNoYXIoXCJpZFwiKS5wcmltYXJ5S2V5KCkuZGVmYXVsdChzcWxgZ2VuX3JhbmRvbV91dWlkKClgKSxcbiAgZW1haWw6IHZhcmNoYXIoXCJlbWFpbFwiKS51bmlxdWUoKSxcbiAgZmlyc3ROYW1lOiB2YXJjaGFyKFwiZmlyc3RfbmFtZVwiKSxcbiAgbGFzdE5hbWU6IHZhcmNoYXIoXCJsYXN0X25hbWVcIiksXG4gIHByb2ZpbGVJbWFnZVVybDogdmFyY2hhcihcInByb2ZpbGVfaW1hZ2VfdXJsXCIpLFxuICBhdXRoUHJvdmlkZXI6IHZhcmNoYXIoXCJhdXRoX3Byb3ZpZGVyXCIpLm5vdE51bGwoKS5kZWZhdWx0KFwicmVwbGl0XCIpLCAvLyBcInJlcGxpdFwiIG9yIFwibG9jYWxcIlxuICBjcmVhdGVkQXQ6IHRpbWVzdGFtcChcImNyZWF0ZWRfYXRcIikuZGVmYXVsdE5vdygpLFxuICB1cGRhdGVkQXQ6IHRpbWVzdGFtcChcInVwZGF0ZWRfYXRcIikuZGVmYXVsdE5vdygpLFxufSk7XG5cbi8vIFVzZXIgY3JlZGVudGlhbHMgdGFibGUgZm9yIHVzZXJuYW1lL3Bhc3N3b3JkIGF1dGhlbnRpY2F0aW9uXG5leHBvcnQgY29uc3QgdXNlckNyZWRlbnRpYWxzID0gcGdUYWJsZShcInVzZXJfY3JlZGVudGlhbHNcIiwge1xuICBpZDogdmFyY2hhcihcImlkXCIpLnByaW1hcnlLZXkoKS5kZWZhdWx0KHNxbGBnZW5fcmFuZG9tX3V1aWQoKWApLFxuICB1c2VySWQ6IHZhcmNoYXIoXCJ1c2VyX2lkXCIpLm5vdE51bGwoKS51bmlxdWUoKS5yZWZlcmVuY2VzKCgpID0+IHVzZXJzLmlkLCB7IG9uRGVsZXRlOiBcImNhc2NhZGVcIiB9KSxcbiAgdXNlcm5hbWU6IHZhcmNoYXIoXCJ1c2VybmFtZVwiKS5ub3ROdWxsKCkudW5pcXVlKCksXG4gIHBhc3N3b3JkSGFzaDogdGV4dChcInBhc3N3b3JkX2hhc2hcIikubm90TnVsbCgpLFxuICBjcmVhdGVkQXQ6IHRpbWVzdGFtcChcImNyZWF0ZWRfYXRcIikuZGVmYXVsdE5vdygpLFxuICB1cGRhdGVkQXQ6IHRpbWVzdGFtcChcInVwZGF0ZWRfYXRcIikuZGVmYXVsdE5vdygpLFxufSwgKHRhYmxlKSA9PiBbXG4gIGluZGV4KFwidXNlcl9jcmVkZW50aWFsc191c2VyX2lkX2lkeFwiKS5vbih0YWJsZS51c2VySWQpLFxuICBpbmRleChcInVzZXJfY3JlZGVudGlhbHNfdXNlcm5hbWVfaWR4XCIpLm9uKHRhYmxlLnVzZXJuYW1lKSxcbl0pO1xuXG4vLyBJZGVudGl0eSBwcm9maWxlcyB0YWJsZVxuZXhwb3J0IGNvbnN0IGlkZW50aXRpZXMgPSBwZ1RhYmxlKFwiaWRlbnRpdGllc1wiLCB7XG4gIGlkOiB2YXJjaGFyKFwiaWRcIikucHJpbWFyeUtleSgpLmRlZmF1bHQoc3FsYGdlbl9yYW5kb21fdXVpZCgpYCksXG4gIHVzZXJJZDogdmFyY2hhcihcInVzZXJfaWRcIikubm90TnVsbCgpLnJlZmVyZW5jZXMoKCkgPT4gdXNlcnMuaWQsIHsgb25EZWxldGU6IFwiY2FzY2FkZVwiIH0pLFxuICBwZXJzb25hbE5hbWU6IHRleHQoXCJwZXJzb25hbF9uYW1lXCIpLm5vdE51bGwoKSxcbiAgY29udGV4dDogdGV4dChcImNvbnRleHRcIikubm90TnVsbCgpLFxuICBvdGhlck5hbWVzOiB0ZXh0KFwib3RoZXJfbmFtZXNcIikuYXJyYXkoKS5kZWZhdWx0KFtdKSxcbiAgLy8gT3B0aW9uYWwgYXR0cmlidXRlcyBmb3IgZW5oYW5jZWQgaWRlbnRpdHkgcHJvZmlsZXNcbiAgcHJvbm91bnM6IHRleHQoXCJwcm9ub3Vuc1wiKSxcbiAgdGl0bGU6IHRleHQoXCJ0aXRsZVwiKSxcbiAgYXZhdGFyVXJsOiB0ZXh0KFwiYXZhdGFyX3VybFwiKSxcbiAgc29jaWFsTGlua3M6IGpzb25iKFwic29jaWFsX2xpbmtzXCIpLmRlZmF1bHQoe30pLCAvLyB7cGxhdGZvcm06IHVybH0gbWFwcGluZ1xuICBpc1ByaW1hcnk6IGJvb2xlYW4oXCJpc19wcmltYXJ5XCIpLmRlZmF1bHQoZmFsc2UpLFxuICBpc0Rpc2NvdmVyYWJsZTogYm9vbGVhbihcImlzX2Rpc2NvdmVyYWJsZVwiKS5kZWZhdWx0KGZhbHNlKSwgLy8gQ29udHJvbHMgdmlzaWJpbGl0eSBpbiBwdWJsaWMgc2VhcmNoXG4gIGNyZWF0ZWRBdDogdGltZXN0YW1wKFwiY3JlYXRlZF9hdFwiKS5kZWZhdWx0Tm93KCksXG4gIHVwZGF0ZWRBdDogdGltZXN0YW1wKFwidXBkYXRlZF9hdFwiKS5kZWZhdWx0Tm93KCksXG59LCAodGFibGUpID0+IFtcbiAgaW5kZXgoXCJpZGVudGl0aWVzX3VzZXJfaWRfaWR4XCIpLm9uKHRhYmxlLnVzZXJJZCksXG4gIGluZGV4KFwiaWRlbnRpdGllc19jb250ZXh0X2lkeFwiKS5vbih0YWJsZS5jb250ZXh0KSxcbl0pO1xuXG4vLyBBdWRpdCBsb2cgdGFibGVcbmV4cG9ydCBjb25zdCBhdWRpdExvZ3MgPSBwZ1RhYmxlKFwiYXVkaXRfbG9nc1wiLCB7XG4gIGlkOiB2YXJjaGFyKFwiaWRcIikucHJpbWFyeUtleSgpLmRlZmF1bHQoc3FsYGdlbl9yYW5kb21fdXVpZCgpYCksXG4gIHVzZXJJZDogdmFyY2hhcihcInVzZXJfaWRcIikubm90TnVsbCgpLnJlZmVyZW5jZXMoKCkgPT4gdXNlcnMuaWQsIHsgb25EZWxldGU6IFwiY2FzY2FkZVwiIH0pLFxuICBlbnRpdHk6IHRleHQoXCJlbnRpdHlcIikubm90TnVsbCgpLFxuICBlbnRpdHlJZDogdmFyY2hhcihcImVudGl0eV9pZFwiKS5ub3ROdWxsKCksXG4gIG9wZXJhdGlvbjogdGV4dChcIm9wZXJhdGlvblwiKS5ub3ROdWxsKCksIC8vIGNyZWF0ZXx1cGRhdGV8ZGVsZXRlfHNldC1wcmltYXJ5XG4gIGRpZmY6IGpzb25iKFwiZGlmZlwiKSxcbiAgY3JlYXRlZEF0OiB0aW1lc3RhbXAoXCJjcmVhdGVkX2F0XCIpLmRlZmF1bHROb3coKSxcbn0sICh0YWJsZSkgPT4gW1xuICBpbmRleChcImF1ZGl0X2xvZ3NfdXNlcl9pZF9pZHhcIikub24odGFibGUudXNlcklkKSxcbiAgaW5kZXgoXCJhdWRpdF9sb2dzX2VudGl0eV9pZHhcIikub24odGFibGUuZW50aXR5KSxcbl0pO1xuXG4vLyBSZWxhdGlvbnNcbmV4cG9ydCBjb25zdCB1c2Vyc1JlbGF0aW9ucyA9IHJlbGF0aW9ucyh1c2VycywgKHsgbWFueSwgb25lIH0pID0+ICh7XG4gIGlkZW50aXRpZXM6IG1hbnkoaWRlbnRpdGllcyksXG4gIGF1ZGl0TG9nczogbWFueShhdWRpdExvZ3MpLFxuICBjcmVkZW50aWFsczogb25lKHVzZXJDcmVkZW50aWFscyksXG59KSk7XG5cbmV4cG9ydCBjb25zdCB1c2VyQ3JlZGVudGlhbHNSZWxhdGlvbnMgPSByZWxhdGlvbnModXNlckNyZWRlbnRpYWxzLCAoeyBvbmUgfSkgPT4gKHtcbiAgdXNlcjogb25lKHVzZXJzLCB7XG4gICAgZmllbGRzOiBbdXNlckNyZWRlbnRpYWxzLnVzZXJJZF0sXG4gICAgcmVmZXJlbmNlczogW3VzZXJzLmlkXSxcbiAgfSksXG59KSk7XG5cbmV4cG9ydCBjb25zdCBpZGVudGl0aWVzUmVsYXRpb25zID0gcmVsYXRpb25zKGlkZW50aXRpZXMsICh7IG9uZSB9KSA9PiAoe1xuICB1c2VyOiBvbmUodXNlcnMsIHtcbiAgICBmaWVsZHM6IFtpZGVudGl0aWVzLnVzZXJJZF0sXG4gICAgcmVmZXJlbmNlczogW3VzZXJzLmlkXSxcbiAgfSksXG59KSk7XG5cbmV4cG9ydCBjb25zdCBhdWRpdExvZ3NSZWxhdGlvbnMgPSByZWxhdGlvbnMoYXVkaXRMb2dzLCAoeyBvbmUgfSkgPT4gKHtcbiAgdXNlcjogb25lKHVzZXJzLCB7XG4gICAgZmllbGRzOiBbYXVkaXRMb2dzLnVzZXJJZF0sXG4gICAgcmVmZXJlbmNlczogW3VzZXJzLmlkXSxcbiAgfSksXG59KSk7XG5cbi8vIFNjaGVtYSB0eXBlc1xuZXhwb3J0IHR5cGUgVXBzZXJ0VXNlciA9IHR5cGVvZiB1c2Vycy4kaW5mZXJJbnNlcnQ7XG5leHBvcnQgdHlwZSBVc2VyID0gdHlwZW9mIHVzZXJzLiRpbmZlclNlbGVjdDtcblxuZXhwb3J0IHR5cGUgSW5zZXJ0VXNlckNyZWRlbnRpYWxzID0gdHlwZW9mIHVzZXJDcmVkZW50aWFscy4kaW5mZXJJbnNlcnQ7XG5leHBvcnQgdHlwZSBVc2VyQ3JlZGVudGlhbHMgPSB0eXBlb2YgdXNlckNyZWRlbnRpYWxzLiRpbmZlclNlbGVjdDtcblxuLy8gUmVnaXN0cmF0aW9uIHNjaGVtYSBmb3IgdXNlcm5hbWUvcGFzc3dvcmRcbmV4cG9ydCBjb25zdCByZWdpc3RlclNjaGVtYSA9IHoub2JqZWN0KHtcbiAgdXNlcm5hbWU6IHouc3RyaW5nKCkubWluKDMpLm1heCg1MCkucmVnZXgoL15bYS16QS1aMC05Xy1dKyQvLCBcIlVzZXJuYW1lIGNhbiBvbmx5IGNvbnRhaW4gbGV0dGVycywgbnVtYmVycywgdW5kZXJzY29yZXMsIGFuZCBoeXBoZW5zXCIpLFxuICBwYXNzd29yZDogei5zdHJpbmcoKS5taW4oOCkubWF4KDEwMCksXG4gIGNvbmZpcm1QYXNzd29yZDogei5zdHJpbmcoKSxcbiAgZW1haWw6IHouc3RyaW5nKCkuZW1haWwoKSxcbiAgZmlyc3ROYW1lOiB6LnN0cmluZygpLm1pbigxKS5tYXgoMTAwKSxcbiAgbGFzdE5hbWU6IHouc3RyaW5nKCkubWluKDEpLm1heCgxMDApLFxufSkucmVmaW5lKChkYXRhKSA9PiBkYXRhLnBhc3N3b3JkID09PSBkYXRhLmNvbmZpcm1QYXNzd29yZCwge1xuICBtZXNzYWdlOiBcIlBhc3N3b3JkcyBkb24ndCBtYXRjaFwiLFxuICBwYXRoOiBbXCJjb25maXJtUGFzc3dvcmRcIl0sXG59KTtcblxuLy8gTG9naW4gc2NoZW1hIGZvciB1c2VybmFtZS9wYXNzd29yZFxuZXhwb3J0IGNvbnN0IGxvZ2luU2NoZW1hID0gei5vYmplY3Qoe1xuICB1c2VybmFtZTogei5zdHJpbmcoKS5taW4oMSwgXCJVc2VybmFtZSBpcyByZXF1aXJlZFwiKSxcbiAgcGFzc3dvcmQ6IHouc3RyaW5nKCkubWluKDEsIFwiUGFzc3dvcmQgaXMgcmVxdWlyZWRcIiksXG59KTtcblxuZXhwb3J0IHR5cGUgUmVnaXN0ZXJJbnB1dCA9IHouaW5mZXI8dHlwZW9mIHJlZ2lzdGVyU2NoZW1hPjtcbmV4cG9ydCB0eXBlIExvZ2luSW5wdXQgPSB6LmluZmVyPHR5cGVvZiBsb2dpblNjaGVtYT47XG5cbmV4cG9ydCBjb25zdCBpbnNlcnRJZGVudGl0eVNjaGVtYSA9IGNyZWF0ZUluc2VydFNjaGVtYShpZGVudGl0aWVzLCB7XG4gIGNvbnRleHQ6IHouZW51bShbXCJ3b3JrXCIsIFwiZ2FtaW5nXCIsIFwic29jaWFsXCIsIFwibGVnYWxcIl0pLFxuICBzb2NpYWxMaW5rczogei5yZWNvcmQoei5zdHJpbmcoKSwgei5zdHJpbmcoKS51cmwoKSkub3B0aW9uYWwoKS5kZWZhdWx0KHt9KSxcbn0pLm9taXQoe1xuICBpZDogdHJ1ZSxcbiAgdXNlcklkOiB0cnVlLFxuICBjcmVhdGVkQXQ6IHRydWUsXG4gIHVwZGF0ZWRBdDogdHJ1ZSxcbn0pO1xuXG5leHBvcnQgY29uc3QgdXBkYXRlSWRlbnRpdHlTY2hlbWEgPSBpbnNlcnRJZGVudGl0eVNjaGVtYS5wYXJ0aWFsKCk7XG5cbmV4cG9ydCB0eXBlIEluc2VydElkZW50aXR5ID0gei5pbmZlcjx0eXBlb2YgaW5zZXJ0SWRlbnRpdHlTY2hlbWE+O1xuZXhwb3J0IHR5cGUgVXBkYXRlSWRlbnRpdHkgPSB6LmluZmVyPHR5cGVvZiB1cGRhdGVJZGVudGl0eVNjaGVtYT47XG5leHBvcnQgdHlwZSBJZGVudGl0eSA9IHR5cGVvZiBpZGVudGl0aWVzLiRpbmZlclNlbGVjdDtcblxuZXhwb3J0IHR5cGUgSW5zZXJ0QXVkaXRMb2cgPSB0eXBlb2YgYXVkaXRMb2dzLiRpbmZlckluc2VydDtcbmV4cG9ydCB0eXBlIEF1ZGl0TG9nID0gdHlwZW9mIGF1ZGl0TG9ncy4kaW5mZXJTZWxlY3Q7XG4iXSwidmVyc2lvbiI6M30=